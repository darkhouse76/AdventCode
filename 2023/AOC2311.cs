using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics.Tracing;
using System.Linq;
using Unity.Mathematics;
using UnityEngine;

namespace CodeTAF
{
    public class AOC2311 : MonoBehaviour
    {
        [SerializeField]
        private bool partTwo = false;
        [SerializeField]
        private bool useTestInput = true;
        [SerializeField]
        private bool run = false;
        private string input;


        void printUniv(char[,] universe) {

            
            for (int row = 0; row < universe.GetLength(1); row++) {
                string toPrint = "";
                for (int col = 0; col < universe.GetLength(0); col++) {
                    toPrint += ("\t" + universe[col, row]);
                }
                print(toPrint);
            }

            
        }

        int amountOfPairs(int n) {
            return (n * (n - 1)) / 2;
        }

        long distPath(Vector2Int startLoc,  Vector2Int endLoc) {            
            Vector2Int path = (endLoc - startLoc);
            return math.abs(path.x) + math.abs(path.y);
        }

        void part1() {


            const char EMPTY_SPACE = '.';
            const char GALAXY = '#';

            string[] image = input.Split("\r\n");
            
            //check and note which parts need expansion  
            bool[] colExpand = new bool[image[0].Length];            
            Array.Fill(colExpand, true);
            bool[] rowExpand = new bool[image[0].Length];
            Array.Fill(rowExpand, true);            

            for (int row  = 0; row < image.Length; row++) {                
                for (int col = 0; col < image[row].Length; col++) {
                    if (image[row][col] == GALAXY) {                        
                        colExpand[col] = false;
                        rowExpand[row] = false;
                    }
                }
            }

            //expand the universe and note galazy Locations;
            char[,] universe = new char[image[0].Length + colExpand.Count(x => x), image.Length + rowExpand.Count(x => x)];
            List<Vector2Int> galaxyLocations = new();            
            
            int expandedRow = -1;
            for (int row = 0; row < image.Length; row++) {
                expandedRow++;
                int expandedCol = -1;
                for (int col = 0; col < image[row].Length; col++) {
                    char curImage = image[row][col];
                    universe[++expandedCol, expandedRow] = curImage;
                    if (curImage == GALAXY) {
                        galaxyLocations.Add(new Vector2Int(expandedCol, expandedRow));
                        continue; 
                    }

                    if (rowExpand[row]) {
                        universe[expandedCol, expandedRow + 1] = EMPTY_SPACE;
                    }
                    if (colExpand[col]) { 
                        universe[++expandedCol, expandedRow] = EMPTY_SPACE;
                        if (rowExpand[row]) { universe[expandedCol, expandedRow+1] = EMPTY_SPACE; }                    
                    }
                    
                }
                if (rowExpand[row]) { expandedRow++;}                
            }
            //debug print stuff / visualization of img
            print("Number of Galaxies = " + galaxyLocations.Count); //debug
            print("Number of Pairs = " + amountOfPairs(galaxyLocations.Count));
            print(universe.GetLength(0) + " x " + universe.GetLength(1));
            printUniv(universe);

            //get all path distances between all galaxies
            long totalPathDist = 0;
            
            for (int i = 0; i < galaxyLocations.Count - 1; i++) {
                Vector2Int startGalaxy = galaxyLocations[i];
                for (int j = i+1; j < galaxyLocations.Count; j++) {
                    totalPathDist += distPath(startGalaxy, galaxyLocations[j]);
                }
            }

            print($"Total sum of all Path Distances = {totalPathDist}");            

        }

        void part2() {            
            const char GALAXY = '#';
            const int SIZE_OF_EXPANSION = 1000000 - 1;

            string[] image = input.Split("\r\n");

            //check and note which parts need expansion  
            bool[] colExpand = new bool[image[0].Length];
            Array.Fill(colExpand, true);
            bool[] rowExpand = new bool[image[0].Length];
            Array.Fill(rowExpand, true);

            for (int row = 0; row < image.Length; row++) {
                for (int col = 0; col < image[row].Length; col++) {
                    if (image[row][col] == GALAXY) {
                        colExpand[col] = false;
                        rowExpand[row] = false;
                    }
                }
            }

            //expand the universe and note galazy Locations;            
            List<Vector2Int> galaxyLocations = new();

            int expandedRow = -1;
            for (int row = 0; row < image.Length; row++) {
                expandedRow++;
                int expandedCol = -1;
                for (int col = 0; col < image[row].Length; col++) {
                    char curImage = image[row][col];
                    expandedCol++;                    
                    if (curImage == GALAXY) {
                        galaxyLocations.Add(new Vector2Int(expandedCol, expandedRow));
                        continue;
                    }                    
                    if (colExpand[col]) {
                        for (int i = 1; i <= SIZE_OF_EXPANSION; i++) {
                            expandedCol++;                            
                        }                     
                    }
                }
                if (rowExpand[row]) { expandedRow += SIZE_OF_EXPANSION; }
            }
            //debug print stuff
            print("Number of Galaxies = " + galaxyLocations.Count); //debug
            print("Number of Pairs = " + amountOfPairs(galaxyLocations.Count));            

            //get all path distances between all galaxies
            long totalPathDist = 0;

            for (int i = 0; i < galaxyLocations.Count - 1; i++) {
                Vector2Int startGalaxy = galaxyLocations[i];
                for (int j = i + 1; j < galaxyLocations.Count; j++) {
                    totalPathDist += distPath(startGalaxy, galaxyLocations[j]);
                }
            }

            print($"Total sum of all Path Distances = {totalPathDist}");
        }

        void Update() {
            if (run) {
                run = false;
                Debug.Log("========================================================================");

                if (useTestInput) { input = InputTest(); }
                else { input = Input(); }

                var startTime = System.DateTime.Now;
                if (partTwo) { part2(); }
                else { part1(); }
                print($"Took {System.DateTime.Now - startTime} to complete.");
            }
        }


        string InputTest() {
            return
@"...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....";
        }

        string Input() {
            return
@"..............................#.........................#.......................#..............................#.........................#..
....#.....#...................................#.............................................................................................
.....................................#..................................#...................................................................
...................................................#....................................................................#...................
...............................................................#..................#...............................#.........................
...............#.......................................#...................................#.....#.......#.........................#........
............................................................................................................................................
............................................................................#...............................................................
.......#.......................#....................#.......................................................................................
........................#..................#....................................................................#...........................
..#.......................................................#.........#....................#....................................#.............
..............#...........................................................#..........................................................#......
......................................#...........................................#..........................#..............................
.....................................................#.........#..........................................................................#.
#.......#....................................#.................................................#............................................
..............................#.......................................#..............#....................#..........#......................
....#...................................#...................................................................................................
....................................................................................................#.......................................
.....................#...........#...............................................#..................................................#.......
...............................................#.........#..................................................#..................#............
..........................................................................#...............#........................#........................
.................#.......................................................................................................#..................
......................................................................................#..................#..............................#...
.............#...................................................................................#..........................................
#...........................#..........#....................................................................................................
.........#........................................................................#...............................#.........................
.....................#.........................#.....................................................#....................#......#..........
.....................................................................#......................................................................
................................#.....................................................................................................#.....
...............#..........................................#.................#................#..............................................
....................................#...........................#...........................................#...............................
.......#...................#................#.......................................#..............................#......................#.
......................#.................................................#................................................#..................
....................................................#......................................#............#...................................
.............#........................#..........................................................#.............#............................
...................#..............................................................#.........................................................
.........................................................#..................#..........#....................................................
........................#.....................#..............................................#.........................................#....
.................................................................#.........................................#...................#............
...................................................#........#.....................................#......................#..................
.........#....................#.......#................................................................#............#.......................
#.............................................................................#.....................................................#.......
..................#.......#.................................................................................................................
.............#........................................................#........................#................#..........#..............#.
.....................................................#......................................................................................
.......#...............#.................#......................#................#..........................................................
...................................#.....................................................#............................#.....................
............................................................................................................................................
...............................#........................................#.........................#.........................................
.....#.........#...............................#...................#.....................................................................#..
............................................................................................................................................
..........#......................................................................#..........................................................
.........................................#.............................................#......#...................#...................#.....
........................#.....#........................................................................#....................................
...................................................#.....#...................#..............................................................
....................................................................#...............#....................................#........#.........
...........................#..............................................................#.................................................
...#........................................#.........#.......................................................#..............#..............
..........#....................................................#................#...........................................................
..................................#..................................................................................#...............#......
.................#..........................................................................................................................
............................................................................................................................................
............................#.............#................................#.........................#.....................#................
.........#.........................................#............#.........................#............................................#....
....#................................................................#.........................#..............#.............................
...................#......................................#.................................................................................
..............................#......#..............................................#..............#................#.......................
.............................................................................#..............................................................
.......#.........................................................................................................................#..........
..............#............#....................#...................#............#.......#.................................#................
................................#......................#................................................#.................................#.
............................................................................................................................................
.#......................#......................................#...............................................#............................
........................................................................#............................#......................................
..................................................#..........................#..........................................#.......#...........
.........................................#..........................................#....................#..............................#...
......#...............#.................................#...................................................................................
....................................#.......................................................................................................
...............................................................#................#........#.........................#..........#.............
..#........#.....#..........#...................#...................................................#.......................................
.......................................#...........................#...........................................#............................
.............................................................................#..............................................................
.......................#..................................#............#...............#.......#.....................................#......
............................................................................................................................................
............#.....#................................#...........#...................................................#............#...........
...........................................#..............................................#.................................................
..................................#..............................................#.....................#....................................
..................................................................#.........................................................................
...#..........................#............................................#................................................................
.......................................................#..........................................#........#........#.......................
.......................................#.................................................................................#......#...........
.................................................#..........#.........#.......................#.............................................
............................................................................................................................................
....#...........#........................................................................................#.......#...........#..............
......................#...........#.......#....................#..............#.....#.......................................................
.........#...............................................................................#..................................................
..................................................#.........................................................................................
...................#......................................#...........................................#...........................#......#..
.............#..........#.....................#....................#........................................................................
...............................................................................#.....#.....#.................#......#.......................
...#.........................#...................................................................#........................#.................
............................................................................................................................................
.......#.........#..........................................#...............................................................................
.................................#..............................................................................................#...........
........................................................................#..............#.......#..................#........................#
.#...................................#......#......#........................................................................................
............................................................................................................................................
.............#................#............................................................#..............#.................................
......#.....................................................#.......................#................#...............................#......
...................#..............................................#.......................................................#.................
....................................#.....................................#.................................................................
........................................................................................................#.......#...........................
....#.....................................#...............#...................#...............#.........................................#...
.....................................................................................#......................................................
....................................................#...........#......................................................#............#.......
........................#...................................................................................#...............................
............................................................................#.....#.........#......................#........................
...#.....#.....#.......................#....................................................................................................
............................................................................................................................................
......................................................................#.....................................................................
......................................................................................#............#..........................#.............
.....#.............#.........................................................#................#.............................................
..............................#..........#............#.....#...........................................................#.............#.....
........................................................................#................#..................................................
..................................................................................#.........................................................
......................#.............#....................#........................................................#.........................
.................#................................#.............#.............#.............................................................
............................................................................................................................................
...#..........................#.............#....................................................#.......#...............#.........#........
........#...........#.................#..................................................................................................#..
..............#.................................#.....#..........................................................#..........................
...........................................................#......#.........................................................................
............................#..................................................#.....................................#......................
...................................................#.......................................#................................................
.#................#................#...............................................#...........................................#.....#......
.............#....................................................................................................#.........................
.........................#...........................................#.....#......................#..........#..............................
........................................#...................#...........................................#...................................
...#......#............................................................................#....................................................
...............................................#.......................................................................#....................";
        }


    }
}
